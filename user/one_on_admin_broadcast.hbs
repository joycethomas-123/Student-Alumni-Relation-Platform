<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<style>

    #chat-container {
        width: 100%;
        margin: auto;
        padding: 20px;
        border: none;
        display: flex;
        flex-direction: column;
        height: 80vh;
        overflow-y: auto;
    }
    
     body{
        background-image: url('/images/logo2.png');
        background-size: 70% auto;
        background-position: center bottom 55%;
        background-repeat: no-repeat;
    }

    @media (max-width: 768px) {
        body {
            background-image: url('/images/logo1.png');
            background-position: center bottom 40%;
        }
    }

    #chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        height: auto;
    }

    .message {
        display: flex;
        align-items: center;
        margin-bottom: 40px;
        padding: 10px;
        position: relative;
        border: none;
        width: 90%;
        box-shadow: 0 0px 4px rgba(0, 0, 0, 0.4);
        transition: box-shadow 0.3s ease;
        max-width: 900px;
        margin-right: 10px;
        background-color:rgb(216, 224, 232);
        margin-right:auto;
        border-radius: 0px 20px 20px 20px;
    }
    .message:hover{
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    }

    
    .delete-link {
        margin-left: 10px;
        color: red;
        cursor: pointer;
        border: none;
        font-size: 14px;
        background: none;
        font-weight: 600;
    }

    .reply-link {
        margin-left: 65px;
        color: #0868b7;
        cursor: pointer;
        border: none;
        background: none;
        font-weight: 600;
        font-size: 14px;
    }

    .reply {
        background-color: #e0f7fa;
        padding: 5px;
        margin-left: 70px;
        margin-bottom: 0px;
        margin-top: 30px;
        font-size: 0.9em;
        border-radius: 5px;
        flex-grow: 1;
        max-height: 70px;
        overflow: auto; 
        word-wrap: break-word;
    }

    .replytext{
        overflow: auto; 
        word-wrap: break-word;
    }

    .actual-message {
        margin-top: 40px;
        margin-bottom: 15px;
        margin-left: 70px;
        max-width: 80%;
        word-wrap: break-word;
        font-weight: 600;
    }

    #imageCarousel {
        text-align: center;
        margin: auto;
    }


    .grid-container {
        margin-top: 30px;
        margin-left: 30px;
        margin-right: 1px;
        margin-bottom: 1px;
      display: grid;
      background-color: none;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      max-width: 400px;
      max-height: 400px;
      overflow: hidden;
      padding: 8px;
      border-radius: 10px;
      position: relative;
    }

    .grid-item {
      position: relative;
      overflow: hidden;
      height: 100%;
    }

    .preview {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }

    .see-more-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      opacity: 0.7; /* Updated opacity value */
      transition: opacity 0.3s ease-in-out;
    }

    .see-more-button {
      background: none;
      border: none;
      color: blue;
      cursor: pointer;
      color: black;
      font-weight: 600;
    }

    .grid-item:hover .see-more-overlay {
      opacity: 1;
    }


    .hidden {
      display: none;
    }

    .extra-items .grid-item:nth-child(n+4) {
      display: none;
    }

    .extra-items .grid-item.see-more-item {
      display: block;
    }


    .delete_time{
        color:grey;
        font-size: 10px; 
        position:absolute;
        right: 15px;
        bottom:15px;
        font-weight: bold;

        }
    .post_time{
        color:grey;
        font-size: 10px; 
        position:absolute;
        right: 15px;
        bottom:0px;
        font-weight: bold;
    }
    .no_delete_time{
        color:grey;
        font-size: 10px; 
        position:absolute;
        right: 15px;
        bottom:0px;
        font-weight: bold;
    }

    .carousel-inner{
        max-height: 250px;
        width: 100%;
    }

    .video-preview_popup{
        width: 100%;
        height: 88%;
    }
    .image-preview_popup{
        width: 100%;
        max-height: 250px;
    }

    @media (max-width: 750px) {
        .actual-message {
        margin-right: 50px;
    }
    }
    @media (max-width: 650px) {
        .actual-message {
        margin-right: 40px;
        font-size: 15px;
    }
    }
    @media (max-width: 550px) {
        .actual-message {
        margin-right: 30px;
    }
    }
    @media (max-width: 460px) {
        .actual-message {
        margin-right: 20px;
        font-size: 14px;
        margin-left: 45px;
    }
    }
    @media (max-width: 400px) {
        .actual-message {
        margin-right: 15px;
    }
    }
    @media (max-width: 480px) {
    .see-more-button {
        font-size: 14px;
    }
    }
    @media (max-width: 391px) {
        .see-more-button {
        font-size: 12px;
    }
    }
    @media (max-height: 942px) and (max-width: 942px) {
       .carousel-inner{
        max-height: 200px;
        width: 100%;
    }

    .video-preview_popup{
        width: 100%;
        max-height: 200px;
    }
    .image-preview_popup{
        width: 100%;
        max-height: 200px;
    }
    }

    @media (max-height: 744px) and (max-width: 744px) {
       .carousel-inner{
        max-height: 170px;
        width: 100%;
    }

    .video-preview_popup{
        width: 100%;
        max-height: 170px;
    }
    .image-preview_popup{
        width: 100%;
        max-height: 170px;
    }
    }
    @media (max-height: 480px) and (max-width: 480px) {
       .carousel-inner{
        max-height: 140px;
        width: 100%;
    }

    .video-preview_popup{
        width: 100%;
        max-height: 140px;
    }
    .image-preview_popup{
        width: 100%;
        max-height: 140px;
    }
    }
    @media (max-height: 458px) and  (max-width: 458px) {
       .carousel-inner{
        max-height: 130px;
        width: 100%;
    }

    .video-preview_popup{
        width: 100%;
        max-height: 100%;
    }
    .image-preview_popup{
        width: 100%;
        max-height: 100%;
    }
    }

    @media (max-height: 500px) {
        .message{
            margin-right: 2px;
        }
    }
     @media (max-width: 500px) {
        .replytext{
            font-size: 12px;
            font-weight: 600;
        }
    }
    

</style>
</head>

<section style="padding-top: 180px;">
<div id="chat-container" >
    <div id="chat-messages">
        {{#each Admin_broadcasts}}
            <div class="message"  id="{{this.MessageId}}">
                <div style="display: flex; flex-direction: column; width: 100%;">
                    {{#if this.textMessage}}
                        {{#if this.noreply}}
                            {{#if this.noDelete}}
                                <div class="reply">replied to : <p class="replytext">{{this.actualMessageContent}}</p></div>
                            {{/if}}
                        {{/if}}
                    {{/if}}

                    {{#if this.multimedia}}
                        <div class="grid-container extra-items">
                            {{#if this.imagePresent}}
                                {{#each this.ImageNames}}
                                    <div class="grid-item">
                                        <img class="preview" src="/broadcast/{{../MessageId}}/{{this}}" alt="Image {{@index}}">
                                    </div>
                                {{/each}}
                            {{/if}}

                            {{#if videoPresent}}
                                {{#each this.VideoNames}}
                                    <div class="grid-item">
                                        <video class="preview" controls>
                                            <source src="/broadcast/{{../MessageId}}/{{this}}" type="video/mp4">
                                        </video>
                                    </div>
                                {{/each}}
                            {{/if}}

                            <!-- Display "See more" only if there are more than three items -->
                            {{#if (gt (add (length this.ImageNames) (length this.VideoNames)) 3)}}
                                <div class="grid-item see-more-item hidden">
                                    <div class="see-more-overlay">
                                        <button class="see-more-button" onclick="location.href='your_redirected_page.html'">See more</button>
                                    </div>
                                </div>
                            {{/if}}
                        </div>
                    {{/if}}

                    <div class="actual-message" {{#if this.yesDelete }}style="font-style: italic;color:red;"{{/if}} >{{{this.messageContent}}}</div>
                        <div style="display: flex;margin-bottom:40px;">
                        </div>
                         {{#if this.yesDelete }}
                            <p class="delete_time" {{#if this.Send}}style="color: rgb(78, 74, 74);"{{/if}}>deleted time : {{this.deleted_time}}</p>
                            <p class="post_time" {{#if this.Send}}style="color: rgb(78, 74, 74);"{{/if}}>posted time : {{this.timestamp}}</p>
                        {{/if}}
                        {{#if this.noDelete}}
                            <p class="no_delete_time" {{#if this.delete}}style="color:rgb(78, 74, 74);"{{/if}}>{{this.timestamp}}</p>
                        {{/if}}
                    </div>
            </div>
        {{/each}}
    </div>
    </div>
</section>
 
 <script>

    function scrollToBottom() {
        var chatMessages = document.getElementById("chat-messages");
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function viewpImage(event) {
        var input = event.target;
        videoCount = 0;

        // Clear previous previews
        document.getElementById('previewContainer').innerHTML = "";
        document.getElementById('userView').src = "";

        if (input.files.length > 30) {
            alert("You can only select up to 30 files at once.");
            input.value = "";
            return;
        }

        var carouselInner = document.createElement("div");
        carouselInner.className = "carousel-inner";

        for (var i = 0; i < input.files.length; i++) {
            var carouselItem = document.createElement("div");
            carouselItem.className = i === 0 ? "carousel-item active" : "carousel-item";

            // Set a fixed height for carousel items
            carouselItem.style.height = "300px"; // Adjust the height as needed

            if (input.files[i].type.includes("video")) {
                videoCount++;
                var videoPreview = document.createElement("video");
                videoPreview.controls = true;
                videoPreview.style.width = "100%"; // Adjust the width as needed
                videoPreview.style.height = "100%"; // Adjust the height as needed

                var source = document.createElement("source");
                source.src = URL.createObjectURL(input.files[i]);
                source.type = input.files[i].type;

                videoPreview.appendChild(source);
                carouselItem.appendChild(videoPreview);
            } else {
                var imgPreview = document.createElement("img");
                imgPreview.style.width = "100%"; // Adjust the width as needed
                imgPreview.style.height = "100%"; // Adjust the height as needed
                imgPreview.src = URL.createObjectURL(input.files[i]);
                carouselItem.appendChild(imgPreview);
            }

            carouselInner.appendChild(carouselItem);
        }

        document.getElementById('previewContainer').appendChild(carouselInner);
    }
    
</script>
<script>
        function sendTimestampOnUnload() {
            const timestamp = new Date().toISOString();
            fetch('/send_timestamp_leave_admin_broadcast/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ timestamp }),
            });
        }
        window.addEventListener('beforeunload', sendTimestampOnUnload);
    </script>
